package com.yandex.div.core.state

import androidx.annotation.AnyThread
import com.yandex.div.core.dagger.DivScope
import javax.inject.Inject

@DivScope
internal class TemporaryDivStateCache @Inject constructor() {
    private val temporaryCache = mutableMapOf<String, MutableMap<String, String>>()

    @AnyThread
    fun getState(cardId: String, path: String) = synchronized(temporaryCache) {
        temporaryCache[cardId]?.get(path)
    }

    @AnyThread
    fun resetCard(cardId: String) = synchronized(temporaryCache) {
        temporaryCache.remove(cardId)
    }

    @AnyThread
    fun putState(cardId: String, path: String, stateId: String) {
        synchronized(temporaryCache) {
            temporaryCache.getOrPut(cardId) { mutableMapOf() }[path] = stateId
        }
    }

    @AnyThread
    fun putRootState(cardId: String, stateId: String) {
        putState(cardId, "/", stateId)
    }

    @AnyThread
    fun clear() {
        temporaryCache.clear()
    }
}
