{
  "cases": [
    {
      "expression": "@{source.filter(equalsOneFromDict)}",
      "expected": {
        "type": "array",
        "value": [
          {
            "value": "one"
          }
        ]
      },
      "variables": [
        {
          "name": "source",
          "type": "array",
          "value": [
            {
              "value": "one"
            },
            {
              "value": "two"
            },
            {
              "value": "three"
            }
          ]
        }
      ],
      "functions": [
        {
          "name": "equalsOneFromDict",
          "body": "@{it.getString('value') == 'one'}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "it",
              "type": "dict"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{source.filter(equalsOne)}",
      "expected": {
        "type": "array",
        "value": [
          "one"
        ]
      },
      "variables": [
        {
          "name": "source",
          "type": "array",
          "value": [
            "one",
            "two",
            "three"
          ]
        }
      ],
      "functions": [
        {
          "name": "equalsOne",
          "body": "@{str == 'one'}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "str",
              "type": "string"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{source.filter(lessThanThree)}",
      "expected": {
        "type": "array",
        "value": [
          1,
          2
        ]
      },
      "variables": [
        {
          "name": "source",
          "type": "array",
          "value": [
            1,
            2,
            3
          ]
        }
      ],
      "functions": [
        {
          "name": "lessThanThree",
          "body": "@{num < 3}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "num",
              "type": "integer"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{source.filter(alwaysFalse)}",
      "expected": {
        "type": "array",
        "value": []
      },
      "variables": [
        {
          "name": "source",
          "type": "array",
          "value": [
            "one",
            "two",
            "three"
          ]
        }
      ],
      "functions": [
        {
          "name": "alwaysFalse",
          "body": "@{false}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "item",
              "type": "string"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{boolArray.filter(isTrue)}",
      "expected": {
        "type": "array",
        "value": [
          true,
          true
        ]
      },
      "variables": [
        {
          "name": "boolArray",
          "type": "array",
          "value": [
            true,
            false,
            true,
            false
          ]
        }
      ],
      "functions": [
        {
          "name": "isTrue",
          "body": "@{value == true}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "value",
              "type": "boolean"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{source.filter(nonExistentFunction)}",
      "expected": {
        "type": "error",
        "value": "Variable 'nonExistentFunction' is missing."
      },
      "variables": [
        {
          "name": "source",
          "type": "array",
          "value": [
            "one",
            "two"
          ]
        }
      ],
      "functions": [],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{source.filter(wrongReturnType)}",
      "expected": {
        "type": "error",
        "value": "Failed to evaluate [filter(wrongReturnType)]. Function must return boolean value."
      },
      "variables": [
        {
          "name": "source",
          "type": "array",
          "value": [
            "one",
            "two"
          ]
        }
      ],
      "functions": [
        {
          "name": "wrongReturnType",
          "body": "@{'not_boolean'}",
          "return_type": "string",
          "arguments": [
            {
              "name": "item",
              "type": "string"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{source.filter(containsQuery)}",
      "expected": {
        "type": "error",
        "value": "Failed to evaluate [filter(containsQuery)]. Exactly 2 argument(s) expected."
      },
      "variables": [
        {
          "name": "source",
          "type": "array",
          "value": [
            "one",
            "two",
            "three"
          ]
        }
      ],
      "functions": [
        {
          "name": "containsQuery",
          "body": "@{contains(it, query)}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "it",
              "type": "string"
            },
            {
              "name": "query",
              "type": "string"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{heterogeneousArray.filter(isStringOne)}",
      "expected": {
        "type": "error",
        "value": "Failed to evaluate [filter(isStringOne)]. Invalid argument type: expected String, got Integer."
      },
      "variables": [
        {
          "name": "heterogeneousArray",
          "type": "array",
          "value": [
            "one",
            42,
            true
          ]
        }
      ],
      "functions": [
        {
          "name": "isStringOne",
          "body": "@{str == 'one'}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "str",
              "type": "string"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{emptyArray.filter(anyFunc)}",
      "expected": {
        "type": "array",
        "value": []
      },
      "variables": [
        {
          "name": "emptyArray",
          "type": "array",
          "value": []
        }
      ],
      "functions": [
        {
          "name": "anyFunc",
          "body": "@{true}",
          "return_type": "boolean",
          "arguments": []
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{integerArray.filter(manyFunc)}",
      "expected": {
        "type": "array",
        "value": [
        ]
      },
      "variables": [
        {
          "name": "integerArray",
          "type": "array",
          "value": [
            20,
            40
          ]
        }
      ],
      "functions": [
        {
          "name": "manyFunc",
          "body": "@{val > 10.0}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "number"
            }
          ]
        },
        {
          "name": "manyFunc",
          "body": "@{val < 10}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "integer"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{mixedArray.filter(manyNumberFunc)}",
      "expected": {
        "type": "array",
        "value": [
          40.5
        ]
      },
      "variables": [
        {
          "name": "mixedArray",
          "type": "array",
          "value": [
            20,
            40.5
          ]
        }
      ],
      "functions": [
        {
          "name": "manyNumberFunc",
          "body": "@{val > 10.0}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "number"
            }
          ]
        },
        {
          "name": "manyNumberFunc",
          "body": "@{val < 10}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "integer"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{mixedColorArray.filter(manyColorFunc)}",
      "expected": {
        "type": "array",
        "value": [
          "#f00",
          "blue"
        ]
      },
      "variables": [
        {
          "name": "mixedColorArray",
          "type": "array",
          "value": [
            "#f00",
            "blue"
          ]
        }
      ],
      "functions": [
        {
          "name": "manyColorFunc",
          "body": "@{val == toColor('#FFFF0000')}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "color"
            }
          ]
        },
        {
          "name": "manyColorFunc",
          "body": "@{val == 'blue'}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "string"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{mixedUrlArray.filter(manyUrlFunc)}",
      "expected": {
        "type": "array",
        "value": [
          "https://divkit.tech",
          "str"
        ]
      },
      "variables": [
        {
          "name": "mixedUrlArray",
          "type": "array",
          "value": [
            "https://divkit.tech",
            "str"
          ]
        }
      ],
      "functions": [
        {
          "name": "manyUrlFunc",
          "body": "@{val == toUrl('https://divkit.tech')}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "url"
            }
          ]
        },
        {
          "name": "manyUrlFunc",
          "body": "@{val == 'str'}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "string"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    },
    {
      "expression": "@{integerArray.filter(datetimeFunc)}",
      "expected": {
        "type": "error",
        "value": "Failed to evaluate [filter(datetimeFunc)]. Invalid argument type: expected DateTime, got Integer."
      },
      "variables": [
        {
          "name": "integerArray",
          "type": "array",
          "value": [
            1,
            2,
            3
          ]
        }
      ],
      "functions": [
        {
          "name": "datetimeFunc",
          "body": "@{true}",
          "return_type": "boolean",
          "arguments": [
            {
              "name": "val",
              "type": "datetime"
            }
          ]
        }
      ],
      "platforms": [
        "web"
      ]
    }
  ]
}
